<!DOCTYPE html>
<html lang="en">

<!--
	File: partial/head.tmpl

	Used: All views, called before anything else
-->

	<head>
		<title>
			<TMPL_IF NAME="NAME"><TMPL_VAR ESCAPE="HTML" NAME="NAME"> (</TMPL_IF>Munin<TMPL_LOOP NAME="PATH"><TMPL_IF NAME="pathname"> :: <TMPL_VAR ESCAPE="HTML" NAME="pathname"></TMPL_IF></TMPL_LOOP><TMPL_IF NAME="NAME">)</TMPL_IF>
		</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="">
		<meta name="author" content="Auto-generated by Munin">
		<TMPL_UNLESS NAME="SHOW_ZOOM_JS">
			<meta http-equiv="refresh" content="300" />
		</TMPL_UNLESS>
		<link rel="shortcut icon" type="image/x-icon" href="<TMPL_VAR NAME='R_PATH' />/static/img/favicon.ico" />
		<link rel="icon" type="image/png" href="<TMPL_VAR NAME='R_PATH' />/static/img/favicon.png" />
		<link href="<TMPL_VAR NAME='R_PATH' />/static/css/bootstrap4.min.css" rel="stylesheet" />
		<link href="<TMPL_VAR NAME='R_PATH' />/static/css/style-munstrap.min.css" rel="stylesheet" />

		<script src="<TMPL_VAR NAME='R_PATH' />/static/js/jquery.min.js"></script>
		<script src="<TMPL_VAR NAME='R_PATH' />/static/js/lazysizes.min.js" async></script>
		<script src="<TMPL_VAR NAME='R_PATH' />/static/js/bootstrap4.min.js"></script>
		<script src="<TMPL_VAR NAME='R_PATH' />/static/js/typeahead.bundle.min.js"></script>
		<script>
			// This is used to build the navigation quick search - there is no backend, so we have to do 
			// it all client side.
			//
			// As a curious side note, commenting out the template loops and whatnot allows vscode to parse
			// the javascript - so please note that the commented out TMPL directives STILL FUNCTION.
			var gen_basegroups = {
				// <TMPL_LOOP NAME="ROOTGROUPS">
					"<TMPL_VAR NAME='NAME' />" : {
						"baseurl" :  "<TMPL_VAR NAME='R_PATH' />/<TMPL_VAR NAME='URL'>",
						"compare" : {
							// <TMPL_IF NAME="COMPARE">
								"Day"   : "<TMPL_VAR NAME='R_PATH' />/<TMPL_LOOP NAME='PATH' /><TMPL_IF NAME='pathname'><TMPL_VAR ESCAPE='URL' NAME='PATHNAME' />/</TMPL_IF></TMPL_LOOP>comparison-day.html",
								"Week"  : "<TMPL_VAR NAME='R_PATH' />/<TMPL_LOOP NAME='PATH' /><TMPL_IF NAME='pathname'><TMPL_VAR ESCAPE='URL' NAME='PATHNAME' />/</TMPL_IF></TMPL_LOOP>comparison-week.html",
								"Month" : "<TMPL_VAR NAME='R_PATH' />/<TMPL_LOOP NAME='PATH' /><TMPL_IF NAME='pathname'><TMPL_VAR ESCAPE='URL' NAME='PATHNAME' />/</TMPL_IF></TMPL_LOOP>comparison-month.html",
								"Year"  : "<TMPL_VAR NAME='R_PATH' />/<TMPL_LOOP NAME='PATH' /><TMPL_IF NAME='pathname'><TMPL_VAR ESCAPE='URL' NAME='PATHNAME' />/</TMPL_IF></TMPL_LOOP>comparison-year.html"
							// </TMPL_IF>
						}
					},
				// </TMPL_LOOP>
			};
			var gen_hosts = {
				// <TMPL_LOOP NAME="ROOTGROUPS">
					// <TMPL_LOOP NAME="GROUPS">
						// <TMPL_IF NAME="NCATEGORIES">
							"<TMPL_VAR ESCAPE='HTML' NAME='NAME' />" : {
								"baseurl" : "<TMPL_VAR NAME='R_PATH' />/<TMPL_VAR NAME='URL'>",
								"services" : {
								// <TMPL_LOOP NAME="CATEGORIES">
									"<TMPL_VAR ESCAPE='HTML' NAME='NAME' />" : "<TMPL_VAR NAME='R_PATH' />/<TMPL_VAR NAME='URL' />",
								// </TMPL_LOOP>
								}
							},
						// </TMPL_IF>
					// </TMPL_LOOP>
				// </TMPL_LOOP>
			};
			var gen_cats = {
				// <TMPL_LOOP NAME="GLOBALCATS">
					"Category :: <TMPL_VAR NAME='NAME'> :: Day" : {
						"baseurl" : "<TMPL_VAR NAME='R_PATH' />/<TMPL_VAR NAME='URLDAY'>"
					},
					"Category :: <TMPL_VAR NAME='NAME'> :: Week" : {
						"baseurl" : "<TMPL_VAR NAME='R_PATH' />/<TMPL_VAR NAME='URLWEEK'>"
					},
					"Category :: <TMPL_VAR NAME='NAME'> :: Month" : {
						"baseurl" : "<TMPL_VAR NAME='R_PATH' />/<TMPL_VAR NAME='URLMONTH'>"
					},
					"Category :: <TMPL_VAR NAME='NAME'> :: Year" : {
						"baseurl" : "<TMPL_VAR NAME='R_PATH' />/<TMPL_VAR NAME='URLYEAR'>"
					},
				// </TMPL_LOOP>
			};

			function absolute(base, relative) {
				var stack = base.split("/"),
					parts = relative.split("/");

				stack.pop(); // remove current file name (or empty string)
				
				// (omit if "base" is the current folder without trailing slash)
				
				for (var i=0; i<parts.length; i++) {
					if (parts[i] == ".")  { continue; }

					if (parts[i] == "..") {
						stack.pop();
					} else {
						stack.push(parts[i]);
					}
				}
				return stack.join("/");
			}

			var navMap = [];

			$.each(gen_cats, function(name, obby) {
				navMap.push( { "name" : name, "link" : absolute(location.href, obby.baseurl) } );
			});

			$.each(gen_hosts, function(name, obby) {
				var host_name = name;
				navMap.push( { "name" : "Host :: " + name, "link" : absolute(location.href, obby.baseurl) });
				$.each(obby.services, function(svcname, url){
					navMap.push( { "name" : "Service :: " + host_name + " :: " + svcname, "link" : absolute(location.href, url) });
				});
			});

			$.each(gen_basegroups, function(name, obby) {
				var host_name = name;
				navMap.push( { "name" : "Host :: " + name, "link" : absolute(location.href, obby.baseurl) });
				$.each(obby.compare, function(svcname, url){
					navMap.push( { "name" : "Compare :: " + host_name + " :: " + svcname, "link" : absolute(location.href, url) });
				});
			});

			var navMapB = new Bloodhound({
				datumTokenizer: function (d) { return Bloodhound.tokenizers.whitespace(d.name); },
				queryTokenizer: Bloodhound.tokenizers.whitespace,
				identify: function (obj) { return obj.link; },
				local: navMap
			});

			$(document).ready(function(){
				$('#findthehost').typeahead({
					hint: true,
					highlight: true,
					minLength: 2,
				},
				{
					name: 'navMap',
					limit: 10,
					display: 'link',
					source: navMapB,
					templates: {
						suggestion: function (data) {
							return '<div>' + data.name + '</div>';
						}
					}
				}
				);

				//$('#findthehost').on('typeahead:change',function(){ $('#formy1').submit(); });
				$('#findthehost').on('typeahead:select',function(){ $('#formy1').submit(); });

				$('#formy1').on('submit', function(){
					inputVal = $('#findthehost').val();
					if ( inputVal.substring(0, 4) == "http" ) {
						window.location.href = inputVal;
					} else {
						$('#findthehost').typeahead('val', '');
					}
					return false;
				});
			});
			
		</script>
	</head>

	<body>

		<nav class="navbar navbar-expand-lg navbar-light bg-light mb-3">
			<a class="navbar-brand" href="<TMPL_VAR NAME='R_PATH' />"><span class="munin-icon"></span> MUNIN</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
		
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav mr-auto">
					<li class="nav-item">
						<a class="nav-link" href="<TMPL_VAR NAME='R_PATH' />">Home</a>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="#" id="navbarProblems" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							Problems
						</a>
						<div class="dropdown-menu" aria-labelledby="navbarProblems">
							<a class="dropdown-item" href="<TMPL_VAR NAME='R_PATH' />/problems.html#critical"><span class="badge alert-danger mr-2"><TMPL_VAR NAME="NCRITICAL"></span>Critical</a>
							<a class="dropdown-item" href="<TMPL_VAR NAME='R_PATH' />/problems.html#warnings"><span class="badge alert-warning mr-2"><TMPL_VAR NAME="NWARNING"></span>Warning</a>
							<a class="dropdown-item" href="<TMPL_VAR NAME='R_PATH' />/problems.html#unknowns"><span class="badge alert-info mr-2"><TMPL_VAR NAME="NUNKNOWN"></span>Unknown</a>
						</div>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="#" id="navbarGroups" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							Groups
						</a>
						<div class="dropdown-menu" aria-labelledby="navbarGroups">
							<TMPL_LOOP NAME="ROOTGROUPS">
								<a class="dropdown-item" href="<TMPL_VAR NAME='R_PATH' />/<TMPL_VAR NAME='URL'>"><TMPL_VAR NAME="NAME"></a>
							</TMPL_LOOP>
						</div>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="#" id="navbarHosts" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							Hosts
						</a>
						<div class="dropdown-menu" aria-labelledby="navbarHosts">
							<TMPL_LOOP NAME="ROOTGROUPS">
								<TMPL_LOOP NAME="GROUPS">
									<TMPL_IF NAME="NCATEGORIES">
										<a class="dropdown-item" href="<TMPL_VAR NAME='R_PATH' />/<TMPL_VAR NAME='URL'>"><TMPL_VAR ESCAPE="HTML" NAME="NAME"></a>
									</TMPL_IF>
								</TMPL_LOOP>
							</TMPL_LOOP>
						</div>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="#" id="navbarCats" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							Categories
						</a>
						<div class="dropdown-menu" aria-labelledby="navbarCats">
								<TMPL_LOOP NAME="GLOBALCATS">
									<a class="dropdown-item" href="<TMPL_VAR NAME='R_PATH' />/<TMPL_VAR NAME='URLDAY'>"><TMPL_VAR NAME="NAME"> - Day</a>
									<a class="dropdown-item" href="<TMPL_VAR NAME='R_PATH' />/<TMPL_VAR NAME='URLWEEK'>"><TMPL_VAR NAME="NAME"> - Week</a>
									<a class="dropdown-item" href="<TMPL_VAR NAME='R_PATH' />/<TMPL_VAR NAME='URLMONTH'>"><TMPL_VAR NAME="NAME"> - Month</a>
									<a class="dropdown-item" href="<TMPL_VAR NAME='R_PATH' />/<TMPL_VAR NAME='URLYEAR'>"><TMPL_VAR NAME="NAME"> - Year</a>
									<TMPL_IF NAME="__first__"><div class="dropdown-divider"></div></TMPL_IF>
									<TMPL_IF NAME="__inner__"><div class="dropdown-divider"></div></TMPL_IF>
								</TMPL_LOOP>
						</div>
					</li>

				</ul>
				<form id="formy1" class="form-inline my-2 my-lg-0 w-25">
					<input class="form-control mr-sm-2 w-100" type="text" id="findthehost" placeholder="Host or Service" aria-label="Search">
				</form>
			</div>
		</nav>

	<div class="container">
		<TMPL_INCLUDE NAME="logo_navigation.tmpl">
